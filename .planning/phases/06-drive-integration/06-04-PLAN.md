---
phase: 06-drive-integration
plan: 04
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/components/drive/drive-recent-view.tsx
  - src/components/drive/drive-preview-panel.tsx
autonomous: true

must_haves:
  truths:
    - "Recent view groups photos by day (Today, Yesterday, date)"
    - "Preview panel shows larger image with metadata"
    - "Keyboard navigation works in preview (arrow keys)"
  artifacts:
    - path: "src/components/drive/drive-recent-view.tsx"
      provides: "Date-grouped recent photos view"
      exports: ["DriveRecentView"]
    - path: "src/components/drive/drive-preview-panel.tsx"
      provides: "Side panel for image preview"
      exports: ["DrivePreviewPanel"]
  key_links:
    - from: "src/components/drive/drive-recent-view.tsx"
      to: "date-fns"
      via: "uses isToday, isYesterday, format for grouping"
      pattern: "import.*from.*date-fns"
    - from: "src/components/drive/drive-preview-panel.tsx"
      to: "src/lib/drive/types.ts"
      via: "imports DriveFile type"
      pattern: "DriveFile"
---

<objective>
Create the Recent view with date grouping and the Preview panel for larger image display with metadata and navigation.

Purpose: Recent view provides quick access to newest photos (default tab). Preview panel enables detailed inspection before selection.
Output: Two components in src/components/drive/ for recent photos and image preview.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/06-drive-integration/06-CONTEXT.md
@.planning/phases/06-drive-integration/06-RESEARCH.md
@src/lib/drive/types.ts
@src/lib/drive/mock-data.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DriveRecentView with date grouping</name>
  <files>src/components/drive/drive-recent-view.tsx</files>
  <action>
Create the Recent photos view with date-grouped sections:

1. Props interface DriveRecentViewProps:
   - files: DriveFile[] (already filtered to recent 30 days, sorted by date desc)
   - selectedIds: Set<string>
   - onSelect: (fileId: string) => void
   - onPreview: (fileId: string) => void

2. Date grouping logic using date-fns:
   ```typescript
   import { isToday, isYesterday, format, parseISO } from 'date-fns'

   function getDateGroupLabel(dateStr: string): string {
     const date = parseISO(dateStr)
     if (isToday(date)) return 'Today'
     if (isYesterday(date)) return 'Yesterday'
     return format(date, 'MMM d')  // "Jan 20"
   }

   function groupByDate(files: DriveFile[]): Map<string, DriveFile[]> {
     const groups = new Map<string, DriveFile[]>()
     for (const file of files) {
       const label = getDateGroupLabel(file.createdTime)
       const group = groups.get(label) || []
       group.push(file)
       groups.set(label, group)
     }
     return groups
   }
   ```

3. Component structure:
   - If files.length === 0: Show empty state "No recent photos"
   - For each date group:
     - Section header with date label (h3 or div with text-sm font-medium text-muted-foreground)
     - Grid of images for that group (reuse grid layout from DriveGrid or inline)
     - mb-6 spacing between groups

4. Reuse DriveGridItem for individual items in each group

5. Maintain selection state across all groups (selectedIds applies to all)

6. Consider adding count badge next to date label: "Today (5)"
  </action>
  <verify>Recent view shows photos grouped by "Today", "Yesterday", "Jan 20" headers</verify>
  <done>Recent view displays photos grouped by date with proper labels</done>
</task>

<task type="auto">
  <name>Task 2: Create DrivePreviewPanel with image and metadata</name>
  <files>src/components/drive/drive-preview-panel.tsx</files>
  <action>
Install shadcn sheet component, then create the preview panel:

```bash
npx shadcn@latest add sheet scroll-area
```

Create DrivePreviewPanel component:

1. Props interface DrivePreviewPanelProps:
   - file: DriveFile | null (null when no preview)
   - isSelected: boolean
   - onSelect: () => void
   - onClose: () => void
   - onPrevious: () => void | null (null if first image)
   - onNext: () => void | null (null if last image)

2. Component structure (NOT using Sheet - use a fixed positioned panel):
   - If file is null: return null (or empty fragment)
   - Fixed panel on right side: fixed right-0 top-0 h-full w-80 lg:w-96
   - Background: bg-background border-l
   - Z-index: z-50 to overlay content

3. Panel layout:
   - Header: close button (X icon), filename truncated
   - Image container: aspect-auto, max-height constrained, object-contain
   - Metadata section:
     - Filename
     - Dimensions: {width} x {height} (if imageMediaMetadata exists)
     - File size: formatted (KB/MB)
     - Date added: format(parseISO(file.createdTime), 'MMM d, yyyy')
   - Action buttons at bottom:
     - Select/Deselect button (primary style)
     - Shows "Selected" checkmark when already selected

4. Navigation arrows:
   - Left/right arrows on image or as buttons
   - ChevronLeft, ChevronRight from lucide-react
   - Disable/hide when at first/last image

5. Keyboard navigation:
   - useEffect with keydown listener
   - ArrowLeft: onPrevious()
   - ArrowRight: onNext()
   - Escape: onClose()
   - Cleanup listener on unmount

6. File size formatting helper:
   ```typescript
   function formatFileSize(bytes: number | undefined): string {
     if (!bytes) return 'Unknown'
     if (bytes < 1024) return `${bytes} B`
     if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`
     return `${(bytes / (1024 * 1024)).toFixed(1)} MB`
   }
   ```

7. Animation: Add transition for slide-in effect (transform translate-x)
  </action>
  <verify>Preview panel shows image, metadata, navigation arrows, and select button</verify>
  <done>Preview panel displays image preview with metadata, navigation, and selection</done>
</task>

</tasks>

<verification>
1. Both components exist in src/components/drive/
2. Recent view groups photos by date with proper labels
3. Preview panel shows larger image with filename, dimensions, size, date
4. Arrow keys navigate between images in preview
5. Escape closes preview
6. Select button toggles selection state
7. No TypeScript errors
</verification>

<success_criteria>
- Date grouping shows "Today", "Yesterday", "Jan 20" format
- Groups are separated visually with headers
- Preview panel slides in from right
- Metadata includes: filename, dimensions, file size, date
- Arrow navigation works (buttons and keyboard)
- Select button shows current state and toggles on click
</success_criteria>

<output>
After completion, create `.planning/phases/06-drive-integration/06-04-SUMMARY.md`
</output>
