---
phase: 04-warnings
plan: 05
type: execute
wave: 3
depends_on: ["04-02", "04-03"]
files_modified:
  - src/components/warnings/warning-timeline.tsx
  - src/components/warnings/warnings-dashboard.tsx
  - src/app/(dashboard)/warnings/page.tsx
  - src/app/(dashboard)/warnings/[employeeId]/page.tsx
  - src/components/layout/nav-items.ts
autonomous: true

must_haves:
  truths:
    - "Manager can view warning history for any employee"
    - "Dashboard shows all employees with active warnings"
    - "Timeline displays warnings chronologically"
    - "Manager can clear warnings after good behavior"
    - "Only managers can access warning pages"
    - "Employees cannot see warnings navigation"
  artifacts:
    - path: "src/components/warnings/warning-timeline.tsx"
      provides: "Vertical timeline of employee warnings"
      min_lines: 80
    - path: "src/components/warnings/warnings-dashboard.tsx"
      provides: "Overview of all employees with warnings"
      min_lines: 100
    - path: "src/app/(dashboard)/warnings/page.tsx"
      provides: "Main warnings dashboard page"
      min_lines: 40
    - path: "src/app/(dashboard)/warnings/[employeeId]/page.tsx"
      provides: "Employee warning history page"
      min_lines: 60
  key_links:
    - from: "src/app/(dashboard)/warnings/page.tsx"
      to: "src/lib/warnings/warning-store.ts"
      via: "warnings data"
      pattern: "useWarningStore"
    - from: "src/components/layout/nav-items.ts"
      to: "manager role check"
      via: "role-based visibility"
      pattern: "role.*manager|manager.*role"
---

<objective>
Build warning history, dashboard, and page routing with manager-only access control.

Purpose: Deliver WARN-05 (warning history per employee), WARN-07 (manager-only access), dashboard overview, and ability to clear warnings. Manager needs to track discipline across all employees.
Output: Timeline view, dashboard, pages, and navigation with proper access control.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/04-warnings/04-02-SUMMARY.md
@.planning/phases/04-warnings/04-03-SUMMARY.md
@src/components/layout/nav-items.ts (reference for navigation structure)
@src/app/(dashboard)/checklists/page.tsx (reference for dashboard page pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Warning Timeline Component</name>
  <files>src/components/warnings/warning-timeline.tsx</files>
  <action>
**warning-timeline.tsx** - Vertical timeline of warnings (per CONTEXT.md):

Props:
- warnings: Warning[]
- onViewDetail: (warning: Warning) => void
- onClearWarning?: (warningId: string) => void (manager only)
- showClearOption?: boolean

Visual design (vertical timeline per CONTEXT.md):
- Vertical line on left side
- Colored dots at each warning, color by level:
  - Verbal: accent/pink
  - Written: amber
  - Final: orange
  - Termination: red
- Dots connected by line
- Cleared warnings: muted dot with strikethrough effect

Each timeline item shows:
- Date (formatted, on the left of line)
- Level badge
- Category
- Description (truncated to 200 chars, expandable)
- Status badge
- Signatures section (expandable, collapsed by default for performance)
- "Clear" button if showClearOption and not already cleared

Click behavior:
- Clicking item calls onViewDetail to show full WarningDetail
- "Clear" button opens confirmation dialog

Clear confirmation dialog:
- Title: "Sterge Avertisment"
- Text: "Aceasta actiune va marca avertismentul ca sters dupa o perioada de comportament bun. Istoricul ramane vizibil."
- Reason field (required): "Motivul stergerii"
- Buttons: "Anuleaza", "Confirma Stergerea"
- On confirm: calls onClearWarning(warningId)

Empty state:
- "Niciun avertisment inregistrat" with checkmark icon
  </action>
  <verify>Timeline renders warnings in chronological order with colored dots</verify>
  <done>Timeline shows warning progression with expandable details</done>
</task>

<task type="auto">
  <name>Task 2: Create Warnings Dashboard</name>
  <files>src/components/warnings/warnings-dashboard.tsx</files>
  <action>
**warnings-dashboard.tsx** - Overview of all employees with warnings:

Props:
- onSelectEmployee: (employeeId: string) => void
- onCreateWarning: () => void

Data fetching:
- Get all warnings from useWarningStore
- Group by employeeId
- Calculate stats per employee:
  - Current level (highest active)
  - Total warnings count
  - Active warnings count (non-cleared)
  - Last warning date
  - Pending acknowledgments count

Display modes (tabs or toggle):
1. "Active" - employees with active warnings
2. "Pending" - employees with pending acknowledgments
3. "All" - full list

Table columns (sortable):
- Employee name
- Current level (badge with color)
- Active warnings (count)
- Last warning (date, relative time)
- Status (pending count if any)
- Actions (view history button)

Sort options:
- By level (highest first - default)
- By name (A-Z)
- By last warning date (newest first)
- By pending count (most first)

Header section:
- Title: "Avertismente"
- Stats cards: Total warnings, Pending acknowledgments, Termination pending
- "Avertisment Nou" button (opens WarningModal)

Visual:
- Use shadcn Table component
- Level badges with appropriate colors
- "Pending termination" highlighted prominently (per CONTEXT.md)
- Click row to view employee history

Employee without warnings:
- Not shown in table (dashboard only shows employees WITH warnings)
  </action>
  <verify>Dashboard shows employees grouped by warning status with sorting</verify>
  <done>Dashboard provides overview of discipline across all employees</done>
</task>

<task type="auto">
  <name>Task 3: Create Pages and Navigation</name>
  <files>src/app/(dashboard)/warnings/page.tsx, src/app/(dashboard)/warnings/[employeeId]/page.tsx, src/components/layout/nav-items.ts</files>
  <action>
**warnings/page.tsx** - Main warnings dashboard:
- Manager-only check: redirect to /dashboard if not manager
- Render WarningsDashboard component
- Wire up WarningModal for creating new warnings
- Handle employee selection -> navigate to /warnings/[employeeId]

**warnings/[employeeId]/page.tsx** - Employee warning history:
- Manager-only check: redirect to /dashboard if not manager
- Get employeeId from params
- Get employee info from mock-users
- Get warnings using getWarningsForEmployee(employeeId)
- Render header: "Istoric Avertismente - {employeeName}"
- Render DisciplineStepper showing current level
- Render WarningTimeline with all warnings
- Render PendingWarningsList if any pending
- "Inapoi" button to return to dashboard
- "Avertisment Nou" button for this specific employee

Wire WarningDetail view:
- Use Dialog or slide-over panel to show full warning details
- Include AcknowledgmentForm for pending warnings

**nav-items.ts** updates:
Add warnings navigation item (WARN-07 - manager only):
```typescript
{
  title: 'Avertismente',
  href: '/warnings',
  icon: AlertTriangle, // from lucide-react
  roles: ['manager'] // CRITICAL: only managers see this
}
```

Navigation should NOT show warnings to employees. Use existing role-filtering pattern from nav-items.ts.

Page protection:
- Both pages check useAuthStore user.role
- If not manager: redirect to /dashboard
- Use same pattern as other protected pages
  </action>
  <verify>Pages render, navigation shows only for managers, employees blocked</verify>
  <done>Warning pages accessible to managers only with proper navigation</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` passes
2. Warning timeline shows chronological history
3. Dashboard lists all employees with warnings
4. Sorting works on dashboard table
5. Can clear warnings with reason
6. Navigation shows "Avertismente" only for managers
7. Employee login does NOT see warnings in navigation
8. Direct URL access to /warnings redirects employees to dashboard
9. Can create warning from dashboard and from employee history
</verification>

<success_criteria>
- WARN-05 satisfied: Manager can view warning history for any employee
- WARN-07 satisfied: Only managers can access warning system
- Timeline visualization shows discipline progression
- Dashboard provides full visibility of discipline status
- Warnings can be cleared but history preserved
- Employee access properly blocked
</success_criteria>

<output>
After completion, create `.planning/phases/04-warnings/04-05-SUMMARY.md`
</output>
