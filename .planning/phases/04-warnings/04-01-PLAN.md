---
phase: 04-warnings
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/warnings/types.ts
  - src/lib/warnings/warning-store.ts
  - src/lib/warnings/templates.ts
  - src/lib/warnings/mock-data.ts
  - src/lib/warnings/index.ts
autonomous: true

must_haves:
  truths:
    - "Warning type exists with required fields (date, description, violation category, discipline level)"
    - "4 discipline levels defined: verbal > written > final > termination"
    - "Signature type captures canvas data, timestamp, and signer info"
    - "Acknowledgment flow tracked with refuses-to-sign option"
    - "Mock data demonstrates realistic warning scenarios"
  artifacts:
    - path: "src/lib/warnings/types.ts"
      provides: "Warning, Signature, Acknowledgment, DisciplineLevel types"
      exports: ["Warning", "Signature", "Acknowledgment", "DisciplineLevel", "ViolationCategory", "WarningStatus"]
    - path: "src/lib/warnings/warning-store.ts"
      provides: "Zustand store for warning CRUD"
      exports: ["useWarningStore"]
    - path: "src/lib/warnings/templates.ts"
      provides: "Warning text templates for each category"
      exports: ["WARNING_TEMPLATES", "getTemplateForCategory"]
    - path: "src/lib/warnings/mock-data.ts"
      provides: "Sample warnings for development"
      min_lines: 80
  key_links:
    - from: "src/lib/warnings/warning-store.ts"
      to: "src/lib/warnings/types.ts"
      via: "type imports"
      pattern: "import.*from.*types"
    - from: "src/lib/warnings/warning-store.ts"
      to: "src/lib/warnings/mock-data.ts"
      via: "initial state"
      pattern: "MOCK_WARNINGS"
---

<objective>
Create the data foundation for the progressive discipline (warning) system.

Purpose: Establish types, stores, templates, and mock data that all warning features depend on. Follows the same pattern as calendar-store and checklist-store.
Output: Complete type system and Zustand store with realistic mock data for warnings and escalation tracking.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@src/lib/calendar/types.ts (reference pattern for types)
@src/lib/calendar/reservation-store.ts (reference pattern for store)
@src/lib/auth/types.ts (User and UserRole types)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Warning Types</name>
  <files>src/lib/warnings/types.ts</files>
  <action>
Create TypeScript types following established project patterns:

**DisciplineLevel type (enum-like union):**
- 'verbal' | 'written' | 'final' | 'termination'
- Export as const array DISCIPLINE_LEVELS = ['verbal', 'written', 'final', 'termination'] as const
- Add DISCIPLINE_LEVEL_LABELS for Romanian display: { verbal: 'Verbal', written: 'Scris', final: 'Final', termination: 'Terminare' }

**ViolationCategory type:**
- 'tardiness' | 'no_show' | 'policy_violation' | 'performance' | 'insubordination' | 'safety_violation' | 'customer_complaint' | 'cash_handling' | 'uniform_appearance' | 'other'
- Export VIOLATION_CATEGORIES array
- Export VIOLATION_CATEGORY_LABELS for Romanian display

**Signature type:**
- dataUrl: string (base64 canvas image)
- signedAt: Date
- signedBy: string (user ID)
- signerName: string (display name at time of signing)
- signerRole: 'manager' | 'angajat'

**Acknowledgment type:**
- signature?: Signature (optional - may refuse)
- refusedToSign: boolean
- refusedAt?: Date
- refusedWitnessedBy?: string (witness name if refused)
- employeeComments?: string (optional comments when acknowledging)
- acknowledgedAt?: Date

**WarningStatus type:**
- 'pending_acknowledgment' | 'acknowledged' | 'refused' | 'cleared'

**Warning type:**
- id: string (UUID)
- employeeId: string (user being warned)
- employeeName: string (denormalized for display)
- managerId: string (manager issuing warning)
- managerName: string (denormalized for display)
- level: DisciplineLevel
- category: ViolationCategory
- description: string (detailed incident description)
- incidentDate: Date (when incident occurred)
- witness?: string (optional witness name per CONTEXT.md)
- managerSignature: Signature (required)
- acknowledgment?: Acknowledgment (filled when employee responds)
- status: WarningStatus
- isCleared: boolean (can be cleared after good behavior)
- clearedAt?: Date
- clearedBy?: string
- clearedReason?: string
- attachments?: string[] (file references for WARN-08 - future)
- createdAt: Date
- updatedAt: Date

Include JSDoc comments in Romanian for field descriptions.
  </action>
  <verify>TypeScript compiles: `cd "/Users/stefanpanaite/Documents/MYDEVFORGE PROJECTS/laserzone-hub" && npx tsc --noEmit src/lib/warnings/types.ts`</verify>
  <done>All warning types exported with discipline levels and violation categories</done>
</task>

<task type="auto">
  <name>Task 2: Create Warning Store and Templates</name>
  <files>src/lib/warnings/warning-store.ts, src/lib/warnings/templates.ts, src/lib/warnings/index.ts</files>
  <action>
**warning-store.ts** - Follow established Zustand patterns:
- Use Zustand with persist middleware
- Storage key: 'laserzone-warnings'
- Initial state from MOCK_WARNINGS

State:
- warnings: Warning[]
- capacityConfig (for escalation tracking)

Actions:
- createWarning(data: Omit<Warning, 'id' | 'createdAt' | 'updatedAt'>) -> returns ID
- updateWarning(id, updates: Partial<Warning>)
- acknowledgeWarning(id, acknowledgment: Acknowledgment) -> updates status
- refuseWarning(id, witnessName?: string) -> sets refusedToSign, updates status
- clearWarning(id, clearedBy: string, reason: string) -> marks warning as cleared
- getWarningById(id) -> Warning | undefined
- getWarningsForEmployee(employeeId: string) -> Warning[]
- getActiveWarningsForEmployee(employeeId: string) -> Warning[] (non-cleared only)
- getPendingAcknowledgments(employeeId: string) -> Warning[] (pending_acknowledgment status)
- getAllPendingWarnings() -> Warning[] (all employees, for dashboard)

Escalation helpers (WARN-09):
- getCurrentLevel(employeeId: string) -> DisciplineLevel | null (based on highest active warning)
- getNextLevel(employeeId: string) -> DisciplineLevel (returns next level, or 'termination' if at final)
- canSkipLevel(fromLevel: DisciplineLevel, toLevel: DisciplineLevel) -> boolean (always true, but records skipped)

**templates.ts** - Warning text templates (WARN-10):
Create WARNING_TEMPLATES object keyed by ViolationCategory:
```typescript
export const WARNING_TEMPLATES: Record<ViolationCategory, { title: string; defaultText: string }> = {
  tardiness: {
    title: 'Intarziere la serviciu',
    defaultText: 'Angajatul a intarziat la serviciu fara o justificare acceptabila...'
  },
  no_show: {
    title: 'Absenta nemotivata',
    defaultText: 'Angajatul nu s-a prezentat la serviciu fara a anunta in prealabil...'
  },
  // ... etc for all categories
}
```

Add function: getTemplateForCategory(category: ViolationCategory) -> { title: string; defaultText: string }

**index.ts** - Barrel export:
- Export all types from types.ts
- Export useWarningStore from warning-store.ts
- Export WARNING_TEMPLATES and getTemplateForCategory from templates.ts
- Export DISCIPLINE_LEVELS, DISCIPLINE_LEVEL_LABELS, VIOLATION_CATEGORIES, VIOLATION_CATEGORY_LABELS
  </action>
  <verify>`npm run build` passes without errors</verify>
  <done>Warning store functional with escalation tracking and templates</done>
</task>

<task type="auto">
  <name>Task 3: Create Realistic Mock Data</name>
  <files>src/lib/warnings/mock-data.ts</files>
  <action>
Create mock data for realistic testing - LaserZone context:

**Reference mock users from src/lib/auth/mock-users.ts** for employee IDs.

**MOCK_WARNINGS (8-10 warnings):**
Demonstrate various scenarios:

1. Employee with verbal warning (tardiness) - acknowledged
2. Employee with verbal + written warning (same person, escalated) - acknowledged
3. Employee with single warning - pending_acknowledgment (for testing ack flow)
4. Employee with single warning - refused (for testing refuse flow)
5. Employee with warning that was cleared - isCleared: true
6. Employee with final warning - acknowledged (serious case)
7. Different violation categories to show variety
8. Mix of recent (last 30 days) and older warnings (90 days ago)

**For each warning include:**
- Realistic Romanian descriptions of incidents
- Proper manager signatures (use mock manager user)
- Acknowledgments where applicable
- Incident dates spread across last 90 days
- Use date-fns for date calculations

**IMPORTANT:** Reference employee IDs from mock-users.ts. Use the 'angajat' role users as warning recipients and 'manager' role users as warning issuers.

Generate dates relative to today for always-fresh mock data.
  </action>
  <verify>Import mock data in store and verify no TypeScript errors: `npm run build`</verify>
  <done>Mock data provides realistic warning scenarios across all discipline levels</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` passes
2. Types are properly exported from src/lib/warnings/index.ts
3. Store initializes with mock data
4. No TypeScript errors in any warnings files
5. Escalation logic correctly calculates next level
</verification>

<success_criteria>
- WARN-01 satisfied: Warning type captures date, description, violation type
- WARN-02 satisfied: 4 discipline levels defined with clear progression
- WARN-04 partial: Acknowledgment type with refusedToSign option
- WARN-05 partial: getWarningsForEmployee returns history
- WARN-06 satisfied: ViolationCategory types defined
- WARN-09 satisfied: getCurrentLevel/getNextLevel for auto-escalation
- WARN-10 satisfied: WARNING_TEMPLATES with default text per category
</success_criteria>

<output>
After completion, create `.planning/phases/04-warnings/04-01-SUMMARY.md`
</output>
