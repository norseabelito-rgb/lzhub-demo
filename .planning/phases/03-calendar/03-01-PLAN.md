---
phase: 03-calendar
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/calendar/types.ts
  - src/lib/calendar/reservation-store.ts
  - src/lib/calendar/customer-store.ts
  - src/lib/calendar/mock-data.ts
  - src/lib/calendar/index.ts
autonomous: true

must_haves:
  truths:
    - "Reservation type exists with required fields (name, phone, date, time, party size, notes)"
    - "Customer type exists with tags and visit history"
    - "Capacity configuration exists per time slot"
    - "Mock data demonstrates realistic reservation patterns"
  artifacts:
    - path: "src/lib/calendar/types.ts"
      provides: "Reservation, Customer, TimeSlot, Capacity types"
      exports: ["Reservation", "Customer", "TimeSlot", "CapacityConfig", "ReservationStatus"]
    - path: "src/lib/calendar/reservation-store.ts"
      provides: "Zustand store for reservation CRUD"
      exports: ["useReservationStore"]
    - path: "src/lib/calendar/customer-store.ts"
      provides: "Zustand store for customer management"
      exports: ["useCustomerStore"]
    - path: "src/lib/calendar/mock-data.ts"
      provides: "Realistic mock reservations and customers"
      min_lines: 100
  key_links:
    - from: "src/lib/calendar/reservation-store.ts"
      to: "src/lib/calendar/types.ts"
      via: "type imports"
      pattern: "import.*from.*types"
    - from: "src/lib/calendar/reservation-store.ts"
      to: "src/lib/calendar/mock-data.ts"
      via: "initial state"
      pattern: "MOCK_RESERVATIONS"
---

<objective>
Create the data foundation for the calendar/reservation system.

Purpose: Establish types, stores, and mock data that all calendar features depend on. This follows the same pattern as Phase 2 (checklist-store) for consistency.
Output: Complete type system and Zustand stores with realistic mock data for reservations and customers.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@src/lib/checklist/types.ts (reference pattern)
@src/lib/checklist/checklist-store.ts (reference pattern)
@src/lib/checklist/mock-data.ts (reference pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Calendar Types</name>
  <files>src/lib/calendar/types.ts</files>
  <action>
Create TypeScript types following the checklist types pattern:

**Reservation type:**
- id: string (UUID)
- customerName: string (required)
- customerPhone: string (required)
- customerEmail?: string (optional)
- date: string (ISO date YYYY-MM-DD)
- time: string (HH:mm format, 30-min intervals)
- partySize: number (required, 1-50)
- occasion?: 'birthday' | 'corporate' | 'regular' | string (custom)
- notes?: string
- status: 'confirmed' | 'cancelled' | 'completed' | 'no_show'
- createdAt: Date
- updatedAt: Date
- createdBy: string (user ID)

**Customer type:**
- id: string (UUID)
- name: string
- phone: string (unique identifier for lookup)
- email?: string
- tags: string[] (custom tags like 'VIP', 'Birthday regular', 'Corporate')
- notes?: string
- createdAt: Date
- lastVisit?: Date
- totalVisits: number

**TimeSlot type:**
- date: string (ISO date)
- time: string (HH:mm)
- capacity: number (max players)
- reserved: number (current bookings)
- reservationIds: string[] (linked reservations)

**CapacityConfig type:**
- defaultCapacity: number (per 30-min slot)
- warningThreshold: number (percentage, default 80)
- overrides: Map of date -> capacity (for special days)

**ReservationStatus type:**
- 'confirmed' | 'cancelled' | 'completed' | 'no_show'

Include JSDoc comments in Romanian for consistency with checklist types.
  </action>
  <verify>TypeScript compiles: `cd "/Users/stefanpanaite/Documents/MYDEVFORGE PROJECTS/laserzone-hub" && npx tsc --noEmit src/lib/calendar/types.ts`</verify>
  <done>All calendar types exported and documented</done>
</task>

<task type="auto">
  <name>Task 2: Create Reservation and Customer Stores</name>
  <files>src/lib/calendar/reservation-store.ts, src/lib/calendar/customer-store.ts, src/lib/calendar/index.ts</files>
  <action>
**reservation-store.ts** - Follow checklist-store.ts pattern exactly:
- Use Zustand with persist middleware
- Storage key: 'laserzone-reservations'
- Initial state from MOCK_RESERVATIONS

Actions:
- createReservation(data) -> returns ID
- updateReservation(id, updates)
- cancelReservation(id) -> sets status to 'cancelled'
- completeReservation(id) -> sets status to 'completed'
- markNoShow(id) -> sets status to 'no_show'
- getReservationById(id)
- getReservationsForDate(date: string) -> Reservation[]
- getReservationsForDateRange(start: string, end: string) -> Reservation[]
- getReservationsForCustomer(phone: string) -> Reservation[]

Conflict detection helpers:
- getSlotCapacity(date: string, time: string) -> { total: number, reserved: number, available: number }
- hasConflict(date: string, time: string, partySize: number) -> { conflict: boolean, reason?: string }

**customer-store.ts** - Simpler store for customer data:
- Storage key: 'laserzone-customers'
- Initial state from MOCK_CUSTOMERS

Actions:
- findOrCreateCustomer(name, phone, email?) -> Customer (upsert pattern)
- updateCustomerTags(id, tags)
- addCustomerNote(id, note)
- getCustomerByPhone(phone) -> Customer | undefined
- searchCustomers(query: string) -> Customer[] (search name, phone, email)
- getCustomerHistory(phone: string) -> { customer: Customer, reservations: Reservation[] }

**index.ts** - Barrel export:
- Export all types from types.ts
- Export useReservationStore from reservation-store.ts
- Export useCustomerStore from customer-store.ts
  </action>
  <verify>`npm run build` passes without errors</verify>
  <done>Both stores functional with all CRUD operations and cross-store customer lookup</done>
</task>

<task type="auto">
  <name>Task 3: Create Realistic Mock Data</name>
  <files>src/lib/calendar/mock-data.ts</files>
  <action>
Create mock data for realistic testing - LaserZone context (laser tag venue):

**MOCK_CUSTOMERS (8-10 customers):**
- Mix of regulars (3+ visits) and new customers (1 visit)
- Include VIP tag on 1-2 customers
- Include Birthday regular tag on 2 customers
- Include Corporate tag on 1 customer
- Romanian names (mix of common names)
- Romanian phone format (+40 7XX XXX XXX)

**MOCK_RESERVATIONS (15-20 reservations):**
- Spread across next 7 days from today
- Various times (10:00 - 20:00 in 30-min slots)
- Party sizes: mix of small (4-6), medium (8-12), large (15-25)
- Occasions: 50% regular, 30% birthday, 20% corporate
- Statuses: mostly confirmed, 2-3 completed (past), 1 cancelled, 1 no_show
- Link to MOCK_CUSTOMERS by phone

**CAPACITY_CONFIG:**
- defaultCapacity: 30 (players per 30-min slot)
- warningThreshold: 80 (%)
- No overrides initially

Use date-fns for date calculations (addDays, format, etc.)
Generate dates relative to today for always-fresh mock data.
Include some time slots near capacity to test warning states.
  </action>
  <verify>Import mock data in store files and verify no TypeScript errors</verify>
  <done>Mock data provides realistic reservation patterns for all calendar features</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` passes
2. Types are properly exported from src/lib/calendar/index.ts
3. Stores initialize with mock data
4. No TypeScript errors in any calendar files
</verification>

<success_criteria>
- Reservation type covers all CALR-01 fields (name, phone, date, time, party size, notes)
- Customer type supports CALR-08 history tracking and CALR-09 notes/tags
- Stores follow established Zustand+persist pattern
- Mock data realistic for laser tag venue
- Capacity config supports CALR-07
</success_criteria>

<output>
After completion, create `.planning/phases/03-calendar/03-01-SUMMARY.md`
</output>
