---
phase: 06-drive-integration
plan: 05
type: execute
wave: 3
depends_on: ["06-01", "06-02", "06-03", "06-04"]
files_modified:
  - src/components/drive/drive-picker.tsx
  - src/components/drive/drive-picker-tabs.tsx
  - src/components/drive/drive-connect.tsx
  - src/app/(app)/drive-test/page.tsx
autonomous: false

must_haves:
  truths:
    - "Picker dialog integrates all components"
    - "Tabs switch between Recent and Browse views"
    - "OAuth simulation shows connect/disconnect state"
    - "Demo page allows testing picker functionality"
  artifacts:
    - path: "src/components/drive/drive-picker.tsx"
      provides: "Main picker dialog wrapper"
      exports: ["DrivePicker"]
    - path: "src/components/drive/drive-picker-tabs.tsx"
      provides: "Recent | Browse Drive tab switcher"
      exports: ["DrivePickerTabs"]
    - path: "src/components/drive/drive-connect.tsx"
      provides: "OAuth connect/disconnect UI"
      exports: ["DriveConnect"]
    - path: "src/app/(app)/drive-test/page.tsx"
      provides: "Test page for Drive picker"
  key_links:
    - from: "src/components/drive/drive-picker.tsx"
      to: "src/lib/drive/drive-store.ts"
      via: "uses useDriveStore for state"
      pattern: "useDriveStore"
    - from: "src/components/drive/drive-picker.tsx"
      to: "src/components/drive/drive-grid.tsx"
      via: "renders DriveGrid for Browse view"
      pattern: "DriveGrid"
    - from: "src/components/drive/drive-picker.tsx"
      to: "src/components/drive/drive-recent-view.tsx"
      via: "renders DriveRecentView for Recent tab"
      pattern: "DriveRecentView"
---

<objective>
Integrate all Drive components into the main picker dialog with tab navigation, OAuth simulation, and a demo page for testing.

Purpose: Complete the Drive integration feature by wiring all components together into a usable picker.
Output: Picker dialog, tab switcher, connect UI, and test page.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/06-drive-integration/06-CONTEXT.md
@.planning/phases/06-drive-integration/06-RESEARCH.md
@.planning/phases/06-drive-integration/06-01-SUMMARY.md
@.planning/phases/06-drive-integration/06-02-SUMMARY.md
@.planning/phases/06-drive-integration/06-03-SUMMARY.md
@.planning/phases/06-drive-integration/06-04-SUMMARY.md
@src/lib/drive/drive-store.ts
@src/components/drive/drive-grid.tsx
@src/components/drive/drive-recent-view.tsx
@src/components/drive/drive-preview-panel.tsx
@src/components/drive/drive-breadcrumb.tsx
@src/components/drive/drive-search.tsx
@src/components/drive/drive-folder-grid.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DrivePickerTabs and DriveConnect components</name>
  <files>
    src/components/drive/drive-picker-tabs.tsx
    src/components/drive/drive-connect.tsx
  </files>
  <action>
Create the tab switcher and OAuth connect components:

**DrivePickerTabs:**

1. Props interface:
   - activeTab: 'recent' | 'browse'
   - onTabChange: (tab: 'recent' | 'browse') => void

2. Use shadcn Tabs component or simple button group:
   - Two tabs: "Recent" and "Browse Drive"
   - Active tab styling: bg-accent or border-b-2 border-primary
   - Inactive: text-muted-foreground hover:text-foreground

3. Icons (optional):
   - Clock icon for Recent
   - FolderOpen icon for Browse Drive

4. Layout: flex with gap-4, border-b for tab bar appearance

**DriveConnect:**

1. Props interface:
   - isConnected: boolean
   - onConnect: () => void
   - onDisconnect: () => void

2. States:
   - Not connected: Show "Connect Google Drive" button with Google Drive icon
   - Connected: Show "Connected" badge with disconnect option

3. Connected state:
   - Green checkmark or badge
   - Small dropdown or button for "Disconnect"
   - User avatar placeholder or Google icon

4. Not connected state:
   - Primary button style
   - Google Drive or Cloud icon
   - Text: "Connect Google Drive"

5. For prototype: Connect is instant (no actual OAuth). Store manages isConnected state.
  </action>
  <verify>Tabs switch correctly, connect button toggles connected state</verify>
  <done>Tab switcher and OAuth connect UI functional</done>
</task>

<task type="auto">
  <name>Task 2: Create DrivePicker main dialog</name>
  <files>src/components/drive/drive-picker.tsx</files>
  <action>
Create the main picker dialog that integrates all components:

1. Props interface DrivePickerProps:
   - onSelect: (files: DriveFile[]) => void
   - onCancel: () => void

2. Get state from useDriveStore:
   - isOpen, isConnected, currentTab, currentFolderId, folderPath
   - selectedIds, selectionMode, previewFileId, searchQuery, isLoading
   - Actions: setTab, navigateToFolder, navigateUp, navigateToPathIndex
   - toggleSelection, clearSelection, setPreviewFile, clearPreview
   - setSearchQuery, connect, close

3. Data fetching (from mock-data):
   - getMockRecentFiles() for Recent tab
   - getMockFilesInFolder(currentFolderId) for Browse tab
   - getMockFoldersInFolder(currentFolderId) for folder navigation
   - Filter by searchQuery if not empty

4. Dialog structure (use shadcn Dialog):
   - max-w-5xl h-[80vh] for large modal
   - Header: Title "Select from Drive", DriveConnect, close button
   - DrivePickerTabs below header
   - Main content area (flex-1 overflow-hidden):
     - If not connected: Show connect prompt
     - If Recent tab: DriveRecentView
     - If Browse tab: DriveBreadcrumb, DriveSearch, DriveFolderGrid, DriveGrid
   - Preview panel (conditional, positioned right)
   - Footer: Selection count, Cancel button, "Use Selected" button

5. Layout with preview panel:
   - Use flex layout
   - Left side: main content (flex-1)
   - Right side: DrivePreviewPanel (fixed width, conditional)

6. Footer actions:
   - Cancel: close(), onCancel()
   - Use Selected: onSelect(getSelectedFiles()), close()
   - Disable "Use Selected" if no selection

7. Search filtering:
   - Filter files/folders by searchQuery (case-insensitive name match)
   - Clear search when changing tabs or folders

8. Preview navigation:
   - Compute previous/next file IDs based on current files array
   - Pass onPrevious/onNext to preview panel (or null if at bounds)

9. Keyboard shortcuts (in addition to preview shortcuts):
   - Enter: Confirm selection (if files selected)
  </action>
  <verify>Picker opens, shows tabs, displays images, selection works, confirm returns files</verify>
  <done>Main picker dialog fully functional with all integrated components</done>
</task>

<task type="auto">
  <name>Task 3: Create demo page for testing</name>
  <files>src/app/(app)/drive-test/page.tsx</files>
  <action>
Create a test page to demonstrate and test the Drive picker:

1. Page component with "use client" directive

2. Page layout:
   - Title: "Drive Integration Test"
   - Description: "Test the Google Drive file picker prototype"

3. Test scenarios section:
   - Button: "Open Picker (Single Select)" - opens picker with mode='single'
   - Button: "Open Picker (Multi Select)" - opens picker with mode='multi'

4. Selection results display:
   - Show selected files after picker closes
   - Display: thumbnail, filename, ID
   - Clear results button

5. Store state display (for debugging):
   - Show current tab, connected state, selection count
   - Use useDriveStore to read state

6. Implementation:
   ```typescript
   'use client'

   import { useState } from 'react'
   import { DrivePicker } from '@/components/drive/drive-picker'
   import { useDriveStore } from '@/lib/drive/drive-store'
   import type { DriveFile } from '@/lib/drive/types'

   export default function DriveTestPage() {
     const [selectedFiles, setSelectedFiles] = useState<DriveFile[]>([])
     const { open, isOpen } = useDriveStore()

     const handleSingleSelect = () => open('single')
     const handleMultiSelect = () => open('multi')

     const handleSelect = (files: DriveFile[]) => {
       setSelectedFiles(files)
     }

     return (
       <div className="p-6 space-y-6">
         {/* ... UI ... */}
         {isOpen && (
           <DrivePicker
             onSelect={handleSelect}
             onCancel={() => {}}
           />
         )}
       </div>
     )
   }
   ```

7. Add basic styling consistent with app design (card backgrounds, spacing)
  </action>
  <verify>Navigate to /drive-test, open picker, select images, see results</verify>
  <done>Test page allows full testing of picker functionality</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Google Drive picker prototype with mock data</what-built>
  <how-to-verify>
    1. Navigate to http://localhost:3000/drive-test
    2. Click "Connect Google Drive" - should show connected state
    3. Verify Recent tab shows photos grouped by date (Today, Yesterday, etc.)
    4. Click "Browse Drive" tab - see folders and breadcrumb
    5. Navigate into a folder - breadcrumb updates
    6. Click an image - preview panel opens on right
    7. Use arrow keys to navigate between images in preview
    8. Click checkbox to select image (checkbox visible on hover)
    9. Test multi-select: select multiple images
    10. Click "Use Selected" - picker closes, selected files shown on page
    11. Test search: type filename, grid filters
    12. Test single-select mode: only one image selectable at a time
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. All four files exist
2. Picker opens via store action
3. Tabs switch between Recent and Browse views
4. Folder navigation works with breadcrumb
5. Search filters files by name
6. Selection works in both single and multi modes
7. Preview shows image with metadata and navigation
8. "Use Selected" returns selected files to caller
9. Test page demonstrates all functionality
</verification>

<success_criteria>
- Picker opens as large modal dialog
- Connect shows simulated OAuth flow
- Recent tab groups photos by date
- Browse tab shows folders, breadcrumb, search
- Preview panel shows larger image with metadata
- Selection state persists across tabs/folders (or clears per design)
- "Use Selected" returns correct DriveFile array
- Test page demonstrates picker in both selection modes
</success_criteria>

<output>
After completion, create `.planning/phases/06-drive-integration/06-05-SUMMARY.md`
</output>
