---
phase: 06-drive-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/drive/types.ts
  - src/lib/drive/mock-data.ts
  - src/lib/drive/drive-store.ts
autonomous: true

must_haves:
  truths:
    - "Drive types match Google Drive API v3 structure"
    - "Mock data provides realistic files and folders"
    - "Store manages picker state with Set-based selection"
  artifacts:
    - path: "src/lib/drive/types.ts"
      provides: "DriveFile, DriveFolder, DriveItem type definitions"
      exports: ["DriveFile", "DriveFolder", "DriveItem", "FolderPath"]
    - path: "src/lib/drive/mock-data.ts"
      provides: "Mock files and folders for prototype"
      exports: ["MOCK_FILES", "MOCK_FOLDERS", "getMockFilesInFolder", "getMockRecentFiles"]
    - path: "src/lib/drive/drive-store.ts"
      provides: "Zustand store for picker state management"
      exports: ["useDriveStore"]
  key_links:
    - from: "src/lib/drive/drive-store.ts"
      to: "src/lib/drive/types.ts"
      via: "imports DriveFile, FolderPath types"
      pattern: "import.*from.*types"
    - from: "src/lib/drive/mock-data.ts"
      to: "src/lib/drive/types.ts"
      via: "uses DriveFile, DriveFolder types"
      pattern: "import.*from.*types"
---

<objective>
Create the data foundation for Google Drive integration: TypeScript types matching Google Drive API v3 structure, mock data generator with Lorem Picsum images, and Zustand store for picker state management.

Purpose: Establish the data layer that all Drive UI components will consume. Types mirror real Google Drive API for future integration.
Output: Three files in src/lib/drive/ providing types, mock data, and state management.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/06-drive-integration/06-CONTEXT.md
@.planning/phases/06-drive-integration/06-RESEARCH.md
@src/lib/auth/auth-store.ts (reference for Zustand patterns)
@src/lib/auth/types.ts (reference for type definition patterns)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Drive types matching Google Drive API v3</name>
  <files>src/lib/drive/types.ts</files>
  <action>
Create TypeScript type definitions for Google Drive integration:

1. DriveFile interface:
   - id: string
   - name: string
   - mimeType: string
   - thumbnailLink: string
   - createdTime: string (ISO 8601)
   - modifiedTime: string
   - parents: string[] (parent folder IDs)
   - size?: number (bytes)
   - imageMediaMetadata?: { width: number, height: number }

2. DriveFolder interface:
   - id: string
   - name: string
   - mimeType: 'application/vnd.google-apps.folder' (literal type)
   - parents: string[]

3. DriveItem union type: DriveFile | DriveFolder

4. FolderPath interface for breadcrumb:
   - id: string
   - name: string

5. DriveTab type: 'recent' | 'browse'

6. SelectionMode type: 'single' | 'multi'

7. DriveState interface (for store state):
   - isOpen: boolean
   - isConnected: boolean (OAuth simulation)
   - currentTab: DriveTab
   - currentFolderId: string | null
   - folderPath: FolderPath[]
   - selectedIds: Set<string>
   - selectionMode: SelectionMode
   - previewFileId: string | null
   - searchQuery: string
   - isLoading: boolean

8. DriveActions interface (for store actions):
   - open, close, setTab, navigateToFolder, navigateUp, navigateToPathIndex
   - toggleSelection, selectAll, clearSelection, getSelectedFiles
   - setPreviewFile, clearPreview, setSearchQuery
   - connect, disconnect (OAuth simulation)

Export all types.
  </action>
  <verify>File exists and TypeScript compiles: `npx tsc --noEmit src/lib/drive/types.ts`</verify>
  <done>All Drive-related types exported and ready for use by store and components</done>
</task>

<task type="auto">
  <name>Task 2: Create mock data generator with Lorem Picsum images</name>
  <files>src/lib/drive/mock-data.ts</files>
  <action>
Create mock data that simulates Google Drive content:

1. Constants:
   - MOCK_ROOT_ID = 'root'
   - Define 3-4 mock folders (e.g., "Event Photos", "Marketing Assets", "Team Photos", "Misc")
   - Each folder should have a subfolder to test 2-level navigation

2. Mock folder structure (MOCK_FOLDERS array):
   - Root level: 4 folders
   - Second level: 1-2 subfolders per root folder
   - Total: ~8-10 folders for realistic breadcrumb testing

3. generateMockFile function:
   - Takes index and folderId parameters
   - Creates consistent IDs: `file-{folderId}-{index}`
   - Uses Lorem Picsum with seed for consistent images: `https://picsum.photos/seed/{id}/200/200`
   - Randomizes createdTime within last 30 days for Recent view testing
   - Returns DriveFile with realistic metadata

4. MOCK_FILES array:
   - Generate 8-15 files per folder
   - Mix of recent dates (last 3 days) and older (up to 30 days)
   - Total ~50-80 mock files

5. Helper functions:
   - getMockFilesInFolder(folderId: string | null): DriveFile[] - files in specific folder
   - getMockFoldersInFolder(folderId: string | null): DriveFolder[] - subfolders
   - getMockRecentFiles(): DriveFile[] - files from last 30 days, sorted by date desc
   - getMockFileById(id: string): DriveFile | undefined

Use date-fns for date manipulation (already installed).
  </action>
  <verify>Import and call `getMockRecentFiles()` - should return array sorted by date</verify>
  <done>Mock data provides 50+ files across 8+ folders with consistent seeded images</done>
</task>

<task type="auto">
  <name>Task 3: Create Zustand store for Drive picker state</name>
  <files>src/lib/drive/drive-store.ts</files>
  <action>
Create Zustand store following project auth-store.ts patterns:

1. Import types from ./types and helpers from ./mock-data

2. Create useDriveStore with create<DriveState & DriveActions>():
   - NO persist middleware (picker state is session-only)

3. Initial state:
   - isOpen: false
   - isConnected: false
   - currentTab: 'recent'
   - currentFolderId: null
   - folderPath: []
   - selectedIds: new Set<string>()
   - selectionMode: 'single'
   - previewFileId: null
   - searchQuery: ''
   - isLoading: false

4. Actions implementation:

   open(mode: SelectionMode): Set isOpen=true, selectionMode=mode, clear selection, reset to 'recent' tab

   close(): Set isOpen=false, clear preview, clear search, keep isConnected

   setTab(tab: DriveTab): Set currentTab, clear selection and preview on tab change

   navigateToFolder(folderId, folderName): Push to folderPath, set currentFolderId, clear selection/preview

   navigateUp(): Pop from folderPath, update currentFolderId to new last item (or null)

   navigateToPathIndex(index): Slice folderPath to index+1, update currentFolderId

   toggleSelection(fileId):
   - If single mode: clear and add new
   - If multi mode: toggle membership in Set
   - Use new Set() to trigger React updates

   selectAll(fileIds): Set all provided IDs (multi mode only)

   clearSelection(): Reset to empty Set

   getSelectedFiles(): Return files from mock data matching selectedIds

   setPreviewFile(fileId): Set previewFileId

   clearPreview(): Set previewFileId to null

   setSearchQuery(query): Set searchQuery

   connect(): Simulate OAuth - set isConnected=true (instant for prototype)

   disconnect(): Set isConnected=false, close picker

5. IMPORTANT: When using Set in Zustand, always create a new Set() to ensure React detects changes.
  </action>
  <verify>Import store in a test: `const { open, close, isOpen } = useDriveStore()` - should work without errors</verify>
  <done>Store exports useDriveStore with all state and actions for picker functionality</done>
</task>

</tasks>

<verification>
1. All three files exist in src/lib/drive/
2. `npm run build` completes without type errors
3. Types match Google Drive API v3 structure for future integration
4. Mock data generates consistent images (same seed = same image)
5. Store actions work correctly (can be verified with React DevTools or simple test)
</verification>

<success_criteria>
- DriveFile type has all fields from Google Drive API v3 File resource
- Mock data has 50+ files across 8+ folders
- Lorem Picsum URLs use seed parameter for consistency
- Store handles single and multi selection modes
- Set-based selection provides O(1) lookups
- No TypeScript errors in the three new files
</success_criteria>

<output>
After completion, create `.planning/phases/06-drive-integration/06-01-SUMMARY.md`
</output>
