---
phase: 04-warnings
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - package.json
  - src/components/warnings/signature-canvas.tsx
  - src/components/warnings/signature-display.tsx
  - src/components/warnings/discipline-stepper.tsx
  - src/components/warnings/index.ts
autonomous: true

must_haves:
  truths:
    - "User can draw signature on canvas with finger or mouse"
    - "Signature can be saved as base64 data URL"
    - "Signature can be cleared and redrawn"
    - "4-level stepper shows current discipline position"
    - "Stepper highlights completed, current, and upcoming levels"
  artifacts:
    - path: "src/components/warnings/signature-canvas.tsx"
      provides: "Interactive canvas for drawing signatures"
      min_lines: 80
    - path: "src/components/warnings/signature-display.tsx"
      provides: "Display captured signature as image"
      min_lines: 30
    - path: "src/components/warnings/discipline-stepper.tsx"
      provides: "4-level discipline progression visual"
      min_lines: 60
  key_links:
    - from: "src/components/warnings/signature-canvas.tsx"
      to: "react-signature-canvas"
      via: "library import"
      pattern: "import.*SignatureCanvas.*from.*react-signature-canvas"
    - from: "src/components/warnings/discipline-stepper.tsx"
      to: "src/lib/warnings/types.ts"
      via: "discipline level types"
      pattern: "DISCIPLINE_LEVELS|DisciplineLevel"
---

<objective>
Build signature and stepper UI components needed for warning forms and displays.

Purpose: Create reusable building blocks for WARN-03 (manager signature) and WARN-02 (discipline level visualization). These components are used by warning form and history views.
Output: Signature canvas with touch support, signature display component, and 4-level discipline stepper.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/04-warnings/04-01-SUMMARY.md
@src/lib/warnings/types.ts (for DisciplineLevel, DISCIPLINE_LEVELS, DISCIPLINE_LEVEL_LABELS)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-signature-canvas and Create Signature Components</name>
  <files>package.json, src/components/warnings/signature-canvas.tsx, src/components/warnings/signature-display.tsx</files>
  <action>
**Install dependency:**
```bash
cd "/Users/stefanpanaite/Documents/MYDEVFORGE PROJECTS/laserzone-hub" && npm install react-signature-canvas
```

Also install types if needed:
```bash
npm install --save-dev @types/react-signature-canvas
```

**signature-canvas.tsx** - Interactive signature pad:

Props:
- onSave: (dataUrl: string) => void
- onClear?: () => void
- width?: number (default: 400)
- height?: number (default: 200)
- disabled?: boolean
- label?: string (e.g., "Semnatura Manager")

Implementation:
- Use react-signature-canvas library
- Canvas with border and light gray background
- Touch support (add CSS: touch-action: none on canvas)
- "Sterge" button to clear signature
- "Confirma" button to save (calls getTrimmedCanvas().toDataURL())
- Disable buttons when canvas is empty
- Handle window resize - store ref and call clear() on resize to prevent distortion
- When disabled, show grayed overlay

Visual styling per project theme:
- Border: border border-border rounded-lg
- Background: bg-muted/30
- Buttons below canvas: flex gap-2

**signature-display.tsx** - Show captured signature:

Props:
- dataUrl: string
- signerName: string
- signedAt: Date
- className?: string

Display:
- Image with the signature dataUrl
- Below image: "{signerName}" and formatted date (using date-fns format)
- Border styling consistent with signature-canvas
- Max width constrained for consistent display
  </action>
  <verify>Components render without errors: `npm run build`</verify>
  <done>Signature canvas captures drawing and displays saved signatures</done>
</task>

<task type="auto">
  <name>Task 2: Create Discipline Stepper Component</name>
  <files>src/components/warnings/discipline-stepper.tsx</files>
  <action>
**discipline-stepper.tsx** - 4-level progression visualization:

Props:
- currentLevel: DisciplineLevel | null (employee's current highest active level)
- selectedLevel?: DisciplineLevel (level being selected in form, if different from current)
- onSelectLevel?: (level: DisciplineLevel) => void (for form selection mode)
- readonly?: boolean (for display-only in history views)
- showLabels?: boolean (default: true)
- size?: 'sm' | 'md' | 'lg' (default: 'md')

Visual design (following shadcn patterns):
- Horizontal stepper with 4 circles connected by lines
- Each circle represents: Verbal -> Scris -> Final -> Terminare
- Circle states:
  - Completed: filled with accent color, checkmark icon
  - Current: filled with accent color, pulsing border
  - Selected (in form): outline with accent color, larger
  - Upcoming: outline with muted color
  - Skipped warning: small warning icon beside circle
- Connector lines between circles:
  - Solid accent color for completed transitions
  - Dashed muted color for upcoming transitions

Colors (use design tokens):
- Verbal: accent color (neon pink)
- Written: amber/warning
- Final: orange/danger
- Termination: red/destructive

Behavior:
- In readonly mode: just display, no interaction
- In form mode: clicking a level selects it
- If selecting level higher than current+1, show "Sari peste niveluri" indicator
- Use DISCIPLINE_LEVEL_LABELS from types.ts for Romanian labels

Responsive:
- On mobile (sm): vertical layout, smaller circles
- On desktop (md+): horizontal layout
  </action>
  <verify>Stepper renders with different states: `npm run build`</verify>
  <done>Discipline stepper visualizes 4-level progression with interaction support</done>
</task>

<task type="auto">
  <name>Task 3: Create Component Barrel Export</name>
  <files>src/components/warnings/index.ts</files>
  <action>
Create barrel export for all warning components:

```typescript
export { SignatureCanvas } from './signature-canvas'
export { SignatureDisplay } from './signature-display'
export { DisciplineStepper } from './discipline-stepper'
```

Ensure all components use 'use client' directive since they have interactivity.

Create the warnings component directory if it doesn't exist.
  </action>
  <verify>All exports resolve: `npm run build`</verify>
  <done>Warning components exportable from single index</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` passes
2. react-signature-canvas installed in package.json
3. SignatureCanvas allows drawing and returns dataUrl
4. SignatureDisplay shows signature image with metadata
5. DisciplineStepper shows 4 levels with correct visual states
6. All components use 'use client' directive
</verification>

<success_criteria>
- WARN-03 partial: SignatureCanvas ready for manager/employee signatures
- WARN-02 visual: DisciplineStepper shows 4-level progression
- Components follow project conventions (shadcn styling, design tokens)
- Touch support works for mobile signature drawing
- Components are reusable building blocks for form and display
</success_criteria>

<output>
After completion, create `.planning/phases/04-warnings/04-02-SUMMARY.md`
</output>
